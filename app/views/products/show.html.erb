<div class="container mt-4">
  <div class="row">
    <div class="col-md-10 mx-auto">

      <!-- Breadcrumb -->
      <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
          <li class="breadcrumb-item">
            <%= link_to @category.title, category_path(@category), class: "text-decoration-none" %>
          </li>
          <li class="breadcrumb-item">
            <%= link_to @subcategory.title, [@category, @subcategory], class: "text-decoration-none" %>
          </li>
          <li class="breadcrumb-item active" aria-current="page"><%= @product.title %></li>
        </ol>
      </nav>

      <!-- Informações principais do produto -->
      <div class="card mb-4" style="border-color: #F7C21A;">
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <h1 class="card-title h2"><%= @product.title %></h1>
              <p class="text-muted mb-3">
                <i class="fa-solid fa-tag me-1"></i>
                <strong><%= @product.line %></strong>
              </p>

              <% if user_signed_in? %>
                <div class="row">
                  <div class="col-sm-6">
                    <small class="text-muted">Criado em:</small>
                    <p><%= @product.created_at.strftime("%d/%m/%Y às %H:%M") %></p>
                  </div>
                  <div class="col-sm-6">
                    <small class="text-muted">Última atualização:</small>
                    <p><%= @product.updated_at.strftime("%d/%m/%Y às %H:%M") %></p>
                  </div>
                </div>
              <% end %>
            </div>

            <!-- Galeria de fotos -->
            <div class="col-md-4">
              <% if @product.photos.attached? %>
                <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                  <div class="carousel-inner">
                    <% @product.photos.each_with_index do |photo, index| %>
                      <div class="carousel-item <%= 'active' if index == 0 %>">
                        <%= image_tag rails_blob_path(photo, only_path: true),
                                      class: "d-block w-100",
                                      style: "border-radius: 8px;",
                                      alt: @product.title %>
                      </div>
                    <% end %>
                  </div>
                  <% if @product.photos.count > 1 %>
                    <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Anterior</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Próximo</span>
                    </button>
                  <% end %>
                </div>
              <% else %>
                <div class="bg-light border rounded d-flex align-items-center justify-content-center" style="height: 250px;">
                  <i class="fa-solid fa-image text-muted" style="font-size: 4rem;"></i>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- Conteúdo rich text -->
      <div class="row">
        <% if @product.characteristics.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100" style="border-color: #F7C21A;">
              <div class="card-header" style="border-color: #F7C21A;">
                <h5 class="mb-0"><i class="fa-solid fa-list-check me-2"></i>Características</h5>
              </div>
              <div class="card-body">
                <%= @product.characteristics %>
              </div>
            </div>
          </div>
        <% end %>

        <% if @product.applications.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100" style="border-color: #F7C21A;">
              <div class="card-header" style="border-color: #F7C21A;">
                <h5 class="mb-0"><i class="fa-solid fa-wrench me-2"></i>Aplicações</h5>
              </div>
              <div class="card-body">
                <%= @product.applications %>
              </div>
            </div>
          </div>
        <% end %>

        <% if @product.types_of_coatings.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100" style="border-color: #F7C21A;">
              <div class="card-header" style="border-color: #F7C21A;">
                <h5 class="mb-0"><i class="fa-solid fa-palette me-2"></i>Tipos de Revestimentos</h5>
              </div>
              <div class="card-body">
                <%= @product.types_of_coatings %>
              </div>
            </div>
          </div>
        <% end %>

        <% if @product.details.present? %>
          <div class="col-md-6 mb-4">
            <div class="card h-100" style="border-color: #F7C21A;">
              <div class="card-header" style="border-color: #F7C21A;">
                <h5 class="mb-0"><i class="fa-solid fa-info-circle me-2"></i>Detalhes</h5>
              </div>
              <div class="card-body">
                <%= @product.details %>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <!-- Imagens de detalhes -->
      <% if @product.details_images.attached? %>
        <div class="card mb-4" style="border-color: #F7C21A;">
          <div class="card-header" style="border-color: #F7C21A;">
            <h5 class="mb-0"><i class="fa-solid fa-images me-2"></i>Imagens de Detalhes</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <% @product.details_images.each do |image| %>
                <div class="col-md-3 mb-3">
                  <%= image_tag rails_blob_path(image, only_path: true),
                                class: "img-fluid rounded",
                                style: "width: 100% !important; height: 200px; object-fit: cover; cursor: pointer;",
                                data: { bs_toggle: "modal", bs_target: "#imageModal#{image.id}" },
                                alt: "Detalhe do produto" %>

                  <!-- Modal para visualizar imagem em tamanho maior -->
                  <div class="modal fade" id="imageModal<%= image.id %>" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                      <div class="modal-content">
                        <div class="modal-body p-0">
                          <%= image_tag rails_blob_path(image, only_path: true),
                                        class: "img-fluid w-100",
                                        alt: "Detalhe do produto" %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Botões de ação -->
      <div class="card mb-3" style="border-color: #F7C21A;">
        <div class="card-footer bg-transparent">
          <% if user_signed_in? %>
            <div class="btn-group w-100" role="group">
              <%= link_to "Voltar", category_subcategory_products_path(@category, @subcategory),
                          class: "btn btn-outline-secondary" %>
              <%= link_to "Editar", edit_category_subcategory_product_path(@category, @subcategory, @product),
                          class: "btn btn-primary" %>
              <%= link_to "Excluir", [@category, @subcategory, @product],
                          method: :delete,
                          class: "btn btn-danger",
                          data: {
                            confirm: "Tem certeza que deseja excluir este produto?",
                            turbo_method: :delete
                          } %>
            </div>
          <% else %>
            <div class="text-center">
              <%= link_to "Voltar", [@category, @subcategory],
                          class: "btn btn-outline-secondary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
